# BS2002失敗実装の削除計画

## ステータス: DRAFT
## 開始日: 2025-01-26
## 言語: Rust（コア実装）

## 1. 背景と問題

### 現在の状況
- BS2002実装は存在するが、217%の重大な誤差
- コードは未使用（コメントアウト）
- テストも`#[ignore]`で無効化
- 修正の見込みが立たない根本的なバグ

### 問題点
1. **誤用リスク**: 将来の開発者が誤って有効化する可能性
2. **認知負荷**: 不要なコードによる理解の妨げ
3. **技術的負債**: 「とりあえず残す」アンチパターン

### Critical Rules違反
- **C002**: エラーを放置している
- **C013**: 破壊的リファクタリング推奨に反する

## 2. 目標

### 必達目標
- [ ] BS2002実装ファイルの完全削除
- [ ] 関連テストの削除
- [ ] 参照の完全除去
- [ ] 失敗の教訓を文書化

### 品質基準
- [ ] cargo test全パス
- [ ] cargo clippyエラーなし
- [ ] 削除後のコード整合性確保

## 3. 実装方針

### Phase 1: 文書化（30分）
**ファイル**: `docs/internal/bs2002_implementation_lessons.md`

BS2002実装の失敗から学んだ教訓を記録：
- 問題の詳細（trigger price計算の誤り）
- Put-call transformation実装の失敗
- 217%誤差の原因分析
- 将来の実装への注意事項

### Phase 2: 削除実行（15分）
**対象ファイル**:
1. `core/src/compute/american_bs2002.rs` - 完全削除
2. `core/src/compute/mod.rs` - モジュール参照削除
3. `core/src/compute/american.rs` - コメントアウト削除

### Phase 3: 検証（15分）
1. ビルド確認
2. テスト実行
3. 品質チェック

## 4. 命名定義

### 4.1 使用する既存命名
```yaml
existing_names:
  # 削除のみのため新規命名なし
```

### 4.2 新規提案命名
```yaml
proposed_names:
  # なし
```

### 4.3 命名の一貫性チェックリスト
- [x] 既存モデルとの整合性確認
- [x] naming_conventions.mdとの一致確認
- [x] ドキュメントでの使用方法定義
- [x] APIパラメータは省略形を使用
- [x] エラーメッセージでもAPI名を使用

## 5. 削除詳細

### 削除対象ファイル
```bash
# 完全削除
rm core/src/compute/american_bs2002.rs
```

### mod.rs の修正
```rust
// 削除前
pub mod american_bs2002;

// 削除後
// （行ごと削除）
```

### american.rs の修正
```rust
// 削除前
// BS2002 is disabled due to implementation issues
// use super::american_bs2002::{bs2002_call, bs2002_put};

// 削除後
// （コメント削除）
```

## 6. 文書化内容

### bs2002_implementation_lessons.md の構成
```markdown
# BS2002実装の失敗から学んだ教訓

## 失敗の概要
- 実装日: 2025-01-26
- 削除日: 2025-01-26
- 問題: 217%の誤差（期待値6.248に対し19.831）

## 技術的問題点
1. Trigger price計算
   - 期待値: ~100
   - 実際: ~200
   - 原因: beta計算またはh(t)関数の誤り

2. Put-call transformation
   - 使用式: P(S,K,r,q) = C(K,S,q,r)
   - 結果: 変換後も誤差が改善せず
   - 推測: psi関数の符号処理に問題

## 教訓
1. 複雑な金融理論の実装には段階的検証が必須
2. 中間値の単体テストの重要性
3. 参照実装との詳細な比較検証の必要性

## 代替手法
- BAW (1987) with dampening: 0.98%誤差で実用十分
- Adaptive dampening: パラメータ領域に応じた調整

## 参考資料
- Bjerksund & Stensland (2002) 原論文
- 削除コミット: [hash]
```

## 7. テスト計画

### 削除前の確認
1. 現在のテスト状況記録
2. BS2002が使用されていないことの確認

### 削除後の検証
1. ビルド成功
2. 全テストパス
3. American option機能の動作確認

## 8. リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 将来BS2002が必要になる | 低 | Git履歴から復元可能、教訓文書参照 |
| 削除による機能劣化 | なし | 未使用コードのため影響なし |
| 参照漏れ | 低 | grep検索で確認 |

## 9. 成功基準

### 必須
- [ ] ファイル削除完了
- [ ] ビルド成功
- [ ] テスト全パス
- [ ] 教訓文書作成

### 確認項目
- [ ] american.rsからの参照なし
- [ ] mod.rsからの参照なし
- [ ] Python側への影響なし

## 10. スケジュール

| フェーズ | 期間 | 内容 |
|----------|------|------|
| Phase 1: 文書化 | 30分 | 教訓の記録 |
| Phase 2: 削除 | 15分 | ファイル削除と参照除去 |
| Phase 3: 検証 | 15分 | ビルドとテスト |

## 11. コミットメッセージ

```
feat(american): BS2002の失敗実装を削除

- 217%の誤差を持つBS2002実装を完全削除
- BAW実装（0.98%誤差）が十分な精度を達成
- Critical Rules C013（破壊的リファクタリング推奨）に準拠
- 教訓はdocs/internal/bs2002_implementation_lessons.mdに記録

削除理由：
- 修正の見込みが立たない根本的なバグ
- 未使用コードによる混乱とリスクの排除
- 技術的負債の解消

削除ファイル：
- core/src/compute/american_bs2002.rs（5,505行）
```

## 12. 注意事項

**Critical Rules遵守**:
- C002: エラー迂回禁止 - 問題のあるコードは削除
- C013: 破壊的リファクタリング推奨 - 不要なコードは即削除

**アンチパターン回避**:
- ❌ 「後で修正するかも」で残さない
- ❌ コメントアウトで残さない
- ✅ Git履歴として保存、教訓を文書化

---
計画作成日: 2025-01-26
作成者: Claude