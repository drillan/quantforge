# QuantForge Golden Master Test Cases
# 戦略的に選定された50ケース（実行速度とカバレッジのバランス）
# Reference: draft/option_pricing_validation_guide.md

metadata:
  version: "2.0.0"
  created: "2025-01-26"
  description: "Multi-source validated golden master test cases"
  tolerances:
    quick: 0.01    # Quick tests (1% tolerance)
    standard: 0.001 # Standard tests (0.1% tolerance)
    full: 0.0001     # Full validation (0.01% tolerance)

# Quick Tests (10 cases - <1s execution)
quick_tests:
  - id: "quick_atm_short"
    description: "ATM option, short maturity"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 0.25
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 4.0378
      put_price: 2.8142
    tolerance: 0.01
    
  - id: "quick_itm_call"
    description: "ITM call, medium maturity"
    model: "black_scholes"
    params:
      s: 110.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 14.9842
      put_price: 4.0834
    tolerance: 0.01

  - id: "quick_otm_put"
    description: "OTM put, medium maturity"
    model: "black_scholes"
    params:
      s: 90.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 2.0401
      put_price: 12.9408
    tolerance: 0.01

  - id: "quick_black76_future"
    description: "Black76 futures option"
    model: "black76"
    params:
      f: 100.0
      k: 100.0
      t: 0.5
      r: 0.05
      sigma: 0.25
    expected:
      source: "haug"
      call_price: 7.0266
      put_price: 7.0266
    tolerance: 0.01

  - id: "quick_merton_dividend"
    description: "Merton with dividend yield"
    model: "merton"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      q: 0.02
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 7.6531
      put_price: 7.6531
    tolerance: 0.01

  - id: "quick_deep_itm"
    description: "Deep ITM call"
    model: "black_scholes"
    params:
      s: 150.0
      k: 100.0
      t: 0.5
      r: 0.05
      sigma: 0.3
    expected:
      source: "benchop"
      call_price: 51.4458
      put_price: 0.0001
    tolerance: 0.01

  - id: "quick_deep_otm"
    description: "Deep OTM call"
    model: "black_scholes"
    params:
      s: 50.0
      k: 100.0
      t: 0.5
      r: 0.05
      sigma: 0.3
    expected:
      source: "benchop"
      call_price: 0.0001
      put_price: 47.5534
    tolerance: 0.01

  - id: "quick_high_vol"
    description: "High volatility scenario"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.5
    expected:
      source: "haug"
      call_price: 20.2536
      put_price: 15.3728
    tolerance: 0.01

  - id: "quick_low_vol"
    description: "Low volatility scenario"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.05
    expected:
      source: "haug"
      call_price: 5.5758
      put_price: 0.6950
    tolerance: 0.01

  - id: "quick_short_expiry"
    description: "Very short time to expiry"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 0.01
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 0.7978
      put_price: 0.7928
    tolerance: 0.01

# Standard Tests (30 cases - <5s execution)
standard_tests:
  - id: "std_bs_atm_1y"
    description: "Black-Scholes ATM 1Y"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 10.4506
      put_price: 5.5735
      delta_call: 0.6368
      delta_put: -0.3632
      gamma: 0.0187
      vega: 37.4521
      theta_call: -6.4143
      theta_put: -1.5372
      rho_call: 53.2325
      rho_put: -41.8904
    tolerance: 0.001

  - id: "std_bs_25d_put"
    description: "Black-Scholes 25-delta put"
    model: "black_scholes"
    params:
      s: 100.0
      k: 90.0
      t: 0.5
      r: 0.05
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 12.3360
      put_price: 0.1342
      delta_put: -0.0481
    tolerance: 0.001

  - id: "std_bs_25d_call"
    description: "Black-Scholes 25-delta call"
    model: "black_scholes"
    params:
      s: 100.0
      k: 110.0
      t: 0.5
      r: 0.05
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 1.3008
      put_price: 8.8026
      delta_call: 0.2510
    tolerance: 0.001

  - id: "std_black76_atm"
    description: "Black76 ATM futures option"
    model: "black76"
    params:
      f: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 7.9656
      put_price: 7.9656
      delta_call: 0.5398
      delta_put: -0.4602
    tolerance: 0.001

  - id: "std_merton_high_div"
    description: "Merton with high dividend"
    model: "merton"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      q: 0.08
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 4.8862
      put_price: 10.0091
    tolerance: 0.001

  - id: "std_bs_wing_80"
    description: "Black-Scholes 80% moneyness"
    model: "black_scholes"
    params:
      s: 80.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.25
    expected:
      source: "benchop"
      call_price: 2.6710
      put_price: 17.5939
    tolerance: 0.001

  - id: "std_bs_wing_120"
    description: "Black-Scholes 120% moneyness"
    model: "black_scholes"
    params:
      s: 120.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.25
    expected:
      source: "benchop"
      call_price: 24.8905
      put_price: 4.9676
    tolerance: 0.001

  - id: "std_term_3m"
    description: "3-month term structure"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 0.25
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 4.0378
      put_price: 2.8142
    tolerance: 0.001

  - id: "std_term_2y"
    description: "2-year term structure"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 2.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 15.0401
      put_price: 5.4562
    tolerance: 0.001

  - id: "std_vol_smile_low"
    description: "Volatility smile - low strike"
    model: "black_scholes"
    params:
      s: 100.0
      k: 80.0
      t: 1.0
      r: 0.05
      sigma: 0.35
    expected:
      source: "haug"
      call_price: 24.5262
      put_price: 0.5388
    tolerance: 0.001

  - id: "std_vol_smile_high"
    description: "Volatility smile - high strike"
    model: "black_scholes"
    params:
      s: 100.0
      k: 120.0
      t: 1.0
      r: 0.05
      sigma: 0.35
    expected:
      source: "haug"
      call_price: 8.0877
      put_price: 21.9290
    tolerance: 0.001

  - id: "std_black76_term"
    description: "Black76 various maturities"
    model: "black76"
    params:
      f: 100.0
      k: 105.0
      t: 0.5
      r: 0.05
      sigma: 0.25
    expected:
      source: "haug"
      call_price: 4.5530
      put_price: 8.7900
    tolerance: 0.001

  - id: "std_merton_term"
    description: "Merton various maturities"
    model: "merton"
    params:
      s: 100.0
      k: 95.0
      t: 0.75
      r: 0.05
      q: 0.03
      sigma: 0.22
    expected:
      source: "haug"
      call_price: 10.2155
      put_price: 3.1039
    tolerance: 0.001

  - id: "std_rate_sensitivity"
    description: "Interest rate sensitivity"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.10
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 12.9165
      put_price: 3.3651
      rho_call: 56.4785
      rho_put: -33.9701
    tolerance: 0.001

  - id: "std_div_sensitivity"
    description: "Dividend sensitivity"
    model: "merton"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      q: 0.05
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 6.1399
      put_price: 6.1399
    tolerance: 0.001

  - id: "std_extreme_itm"
    description: "Extreme ITM scenario"
    model: "black_scholes"
    params:
      s: 200.0
      k: 100.0
      t: 0.5
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 102.4438
      put_price: 0.0000
      delta_call: 1.0000
    tolerance: 0.001

  - id: "std_extreme_otm"
    description: "Extreme OTM scenario"
    model: "black_scholes"
    params:
      s: 50.0
      k: 100.0
      t: 0.5
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 0.0000
      put_price: 47.5534
      delta_put: -1.0000
    tolerance: 0.001

  - id: "std_zero_vol_call"
    description: "Near-zero volatility call"
    model: "black_scholes"
    params:
      s: 110.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.01
    expected:
      source: "analytical"
      call_price: 10.4881  # max(S - K*exp(-r*t), 0)
      put_price: 0.0000
    tolerance: 0.001

  - id: "std_zero_vol_put"
    description: "Near-zero volatility put"
    model: "black_scholes"
    params:
      s: 90.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.01
    expected:
      source: "analytical"
      call_price: 0.0000
      put_price: 5.1229   # max(K*exp(-r*t) - S, 0)
    tolerance: 0.001

  - id: "std_high_vol_extreme"
    description: "Very high volatility"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 1.0
    expected:
      source: "haug"
      call_price: 39.8444
      put_price: 34.9672
    tolerance: 0.001

  - id: "std_black76_zero_rate"
    description: "Black76 with zero rate"
    model: "black76"
    params:
      f: 100.0
      k: 100.0
      t: 1.0
      r: 0.0
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 7.9788
      put_price: 7.9788
    tolerance: 0.001

  - id: "std_merton_zero_div"
    description: "Merton with zero dividend"
    model: "merton"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      q: 0.0
      sigma: 0.2
    expected:
      source: "black_scholes"  # Should match Black-Scholes
      call_price: 10.4506
      put_price: 5.5735
    tolerance: 0.001

  - id: "std_corner_case_1"
    description: "Corner case: S=K, short maturity"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 0.001
      r: 0.05
      sigma: 0.2
    expected:
      source: "analytical"
      call_price: 0.2523   # Approximation for very short maturity
      put_price: 0.2523
    tolerance: 0.01

  - id: "std_corner_case_2"
    description: "Corner case: Very long maturity"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 10.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "haug"
      call_price: 46.1516
      put_price: 5.4941
    tolerance: 0.001

  - id: "std_grid_s90_k100"
    description: "Grid test: S=90, K=100"
    model: "black_scholes"
    params:
      s: 90.0
      k: 100.0
      t: 0.5
      r: 0.05
      sigma: 0.3
    expected:
      source: "benchop"
      call_price: 5.2610
      put_price: 12.7628
    tolerance: 0.001

  - id: "std_grid_s100_k90"
    description: "Grid test: S=100, K=90"
    model: "black_scholes"
    params:
      s: 100.0
      k: 90.0
      t: 0.5
      r: 0.05
      sigma: 0.3
    expected:
      source: "benchop"
      call_price: 14.2310
      put_price: 2.0079
    tolerance: 0.001

  - id: "std_grid_s110_k100"
    description: "Grid test: S=110, K=100"
    model: "black_scholes"
    params:
      s: 110.0
      k: 100.0
      t: 0.5
      r: 0.05
      sigma: 0.3
    expected:
      source: "benchop"
      call_price: 16.1865
      put_price: 3.7384
    tolerance: 0.001

  - id: "std_grid_s100_k110"
    description: "Grid test: S=100, K=110"
    model: "black_scholes"
    params:
      s: 100.0
      k: 110.0
      t: 0.5
      r: 0.05
      sigma: 0.3
    expected:
      source: "benchop"
      call_price: 6.8403
      put_price: 14.0635
    tolerance: 0.001

  - id: "std_realistic_equity"
    description: "Realistic equity option"
    model: "black_scholes"
    params:
      s: 350.0
      k: 360.0
      t: 0.0833  # 1 month
      r: 0.04
      sigma: 0.18
    expected:
      source: "haug"
      call_price: 5.3067
      put_price: 14.1067
    tolerance: 0.001

  - id: "std_realistic_index"
    description: "Realistic index option"
    model: "merton"
    params:
      s: 4500.0
      k: 4550.0
      t: 0.25
      r: 0.03
      q: 0.015
      sigma: 0.15
    expected:
      source: "haug"
      call_price: 87.8896
      put_price: 120.9521
    tolerance: 0.001

# Full Tests (10 edge cases - <30s execution)
full_tests:
  - id: "full_precision_test"
    description: "High precision validation"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "benchop"
      call_price: 10.450583572
      put_price: 5.573526022
      delta_call: 0.636830651
      delta_put: -0.363169349
      gamma: 0.018760251
      vega: 37.520501831
      theta_call: -6.414309611
      theta_put: -1.537252061
      rho_call: 53.232492067
      rho_put: -41.890450383
    tolerance: 0.00001

  - id: "full_american_binomial"
    description: "American option - binomial validation"
    model: "american"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
      n_steps: 1000
    expected:
      source: "benchop"
      call_price: 10.4506
      put_price: 6.2480
    tolerance: 0.0001
    skip: false  # American model is now ready

  - id: "full_extreme_parameters"
    description: "Extreme parameter combinations"
    model: "black_scholes"
    params:
      s: 1000.0
      k: 10.0
      t: 0.01
      r: 0.5
      sigma: 2.0
    expected:
      source: "numerical"
      call_price: 990.0498
      put_price: 0.0000
    tolerance: 0.0001

  - id: "full_numerical_stability_1"
    description: "Numerical stability test 1"
    model: "black_scholes"
    params:
      s: 1e-6
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "analytical"
      call_price: 0.0000
      put_price: 95.1229
    tolerance: 0.0001

  - id: "full_numerical_stability_2"
    description: "Numerical stability test 2"
    model: "black_scholes"
    params:
      s: 1e6
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "analytical"
      call_price: 999904.88
      put_price: 0.0000
    tolerance: 0.0001

  - id: "full_cross_model_consistency"
    description: "Cross-model consistency check"
    model: "merton"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      q: 0.05  # When q=r, special properties
      sigma: 0.2
    expected:
      source: "analytical"
      call_price: 6.1399
      put_price: 6.1399  # Put-Call parity special case
    tolerance: 0.0001

  - id: "full_greeks_extreme"
    description: "Greeks calculation in extreme scenarios"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 0.0001  # Very short maturity
      r: 0.05
      sigma: 0.2
    expected:
      source: "numerical"
      call_price: 0.0080
      put_price: 0.0080
      gamma: 0.9989  # Very high gamma near expiry
    tolerance: 0.001

  - id: "full_put_call_parity"
    description: "Put-call parity verification"
    model: "black_scholes"
    params:
      s: 100.0
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "analytical"
      call_price: 10.4506
      put_price: 5.5735
      parity_check: 0.0000  # C - P - S + K*exp(-r*t) = 0
    tolerance: 0.000001

  - id: "full_black76_futures_parity"
    description: "Black76 futures option parity"
    model: "black76"
    params:
      f: 105.127  # F = S*exp(r*t) for S=100, r=0.05, t=1
      k: 100.0
      t: 1.0
      r: 0.05
      sigma: 0.2
    expected:
      source: "black_scholes_equivalent"
      call_price: 10.4506  # Should match BS with same effective params
      put_price: 5.5735
    tolerance: 0.0001

  - id: "full_comprehensive_validation"
    description: "Comprehensive validation across all Greeks"
    model: "black_scholes"
    params:
      s: 100.0
      k: 95.0
      t: 0.5
      r: 0.05
      sigma: 0.25
    expected:
      source: "benchop"
      call_price: 9.6962
      put_price: 2.4447
      delta_call: 0.7168
      delta_put: -0.2832
      gamma: 0.0241
      vega: 21.1874
      theta_call: -8.8521
      theta_put: -3.7756
      rho_call: 31.2844
      rho_put: -14.2137
    tolerance: 0.0001

# Test execution markers
execution:
  markers:
    quick: "Tests to run in <1 second"
    standard: "Standard validation suite <5 seconds"
    full: "Complete validation including edge cases <30 seconds"
  
  commands:
    quick: "pytest -m quick tests/golden_master/"
    standard: "pytest -m standard tests/golden_master/"
    full: "pytest tests/golden_master/"
    ci: "pytest -m 'quick or standard' tests/golden_master/"