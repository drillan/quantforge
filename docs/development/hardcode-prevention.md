# ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰é˜²æ­¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## æ¦‚è¦

QuantForgeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€æŠ€è¡“çš„è² å‚µã‚¼ãƒ­ã®åŸå‰‡ã«åŸºã¥ãã€è¨­å®šå€¤ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’å®Œå…¨ã«ç¦æ­¢ã—ã¦ã„ã¾ã™ã€‚
ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€é–‹ç™ºè€…ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’é¿ã‘ã€é©åˆ‡ãªå®šæ•°ç®¡ç†ã‚’è¡Œã†ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã™ã€‚

## ãªãœãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãŒå•é¡Œãªã®ã‹

1. **ä¿å®ˆæ€§ã®ä½ä¸‹**: åŒã˜å€¤ãŒè¤‡æ•°ç®‡æ‰€ã«æ•£åœ¨ã—ã€å¤‰æ›´æ™‚ã«æ¼ã‚ŒãŒç™ºç”Ÿ
2. **å¯èª­æ€§ã®ä½ä¸‹**: ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã®æ„å‘³ãŒä¸æ˜ç¢º
3. **ãƒ†ã‚¹ãƒˆã®å›°é›£ã•**: å€¤ã®å¤‰æ›´ãŒå›°é›£ã§ãƒ†ã‚¹ãƒˆã®æŸ”è»Ÿæ€§ãŒå¤±ã‚ã‚Œã‚‹
4. **æŠ€è¡“çš„è² å‚µ**: å¾Œã§ä¿®æ­£ã™ã‚‹ã‚³ã‚¹ãƒˆãŒå¢—å¤§

## è¨­å®šå€¤ã®ç®¡ç†ä½“ç³»

### å®šæ•°ã®é…ç½®å ´æ‰€

| ç¨®é¡ | Rusté…ç½®å ´æ‰€ | Pythoné…ç½®å ´æ‰€ | ä¾‹ |
|------|-------------|---------------|-----|
| ç²¾åº¦ãƒ»è¨±å®¹èª¤å·® | `src/constants.rs` | `tests/conftest.py` | `PRACTICAL_TOLERANCE = 1e-3` |
| æ•°å­¦å®šæ•°ãƒ»ä¿‚æ•° | ä½¿ç”¨ç®‡æ‰€ã®è¿‘ã | ä½¿ç”¨ç®‡æ‰€ã®è¿‘ã | Abramowitzä¿‚æ•° |
| å…¥åŠ›æ¤œè¨¼åˆ¶é™ | `src/validation.rs` | - | ä¾¡æ ¼ãƒ»æ™‚é–“ã®ç¯„å›² |
| ãƒ†ã‚¹ãƒˆç”¨å€¤ | - | `tests/conftest.py` | æ¨™æº–ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ |

### ç¾åœ¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹ä¸»è¦å®šæ•°

#### ç²¾åº¦ãƒ¬ãƒ™ãƒ«ï¼ˆRust/Pythonå…±é€šï¼‰

```rust
// src/constants.rs
pub const PRACTICAL_TOLERANCE: f64 = 1e-3;   // å®Ÿå‹™ç²¾åº¦
pub const THEORETICAL_TOLERANCE: f64 = 1e-5; // ç†è«–ç²¾åº¦
pub const NUMERICAL_TOLERANCE: f64 = 1e-7;   // æ•°å€¤ç²¾åº¦
```

```python
# tests/conftest.py
PRACTICAL_TOLERANCE: Final[float] = 1e-3   # å®Ÿå‹™ç²¾åº¦
THEORETICAL_TOLERANCE: Final[float] = 1e-5 # ç†è«–ç²¾åº¦
NUMERICAL_TOLERANCE: Final[float] = 1e-7   # æ•°å€¤ç²¾åº¦
```

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. æ–°è¦å®Ÿè£…æ™‚

```bash
# Step 1: æ—¢å­˜å®šæ•°ã®ç¢ºèª
grep -r "ä½¿ã„ãŸã„å€¤" src/constants.rs tests/conftest.py

# Step 2: å®šæ•°ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯å®šç¾©
# ä¾‹: src/constants.rs ã«è¿½åŠ 
pub const NEW_CONSTANT: f64 = 3.14159; // Ï€ - å††å‘¨ç‡

# Step 3: å®Ÿè£…ã§ä½¿ç”¨
use crate::constants::NEW_CONSTANT;

# Step 4: æ¤œè¨¼
./scripts/detect_hardcode.sh
```

### 2. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿®æ­£æ™‚

ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ãŸå ´åˆï¼š

```rust
// Beforeï¼ˆæ‚ªã„ä¾‹ï¼‰
if x > 8.0 { return 1.0; }

// Afterï¼ˆè‰¯ã„ä¾‹ï¼‰
const NORM_CDF_UPPER_BOUND: f64 = 8.0;
if x > NORM_CDF_UPPER_BOUND { return 1.0; }
```

### 3. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆæ™‚

```python
# Beforeï¼ˆæ‚ªã„ä¾‹ï¼‰
assert abs(actual - expected) < 1e-5

# Afterï¼ˆè‰¯ã„ä¾‹ï¼‰
from conftest import THEORETICAL_TOLERANCE
assert abs(actual - expected) < THEORETICAL_TOLERANCE
```

## ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰æ¤œå‡ºãƒ„ãƒ¼ãƒ«

### è‡ªå‹•æ¤œå‡ºã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# å®Ÿè¡Œæ–¹æ³•
./scripts/detect_hardcode.sh

# å‡ºåŠ›ä¾‹
ğŸ” QuantForge ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰æ¤œå‡ºã‚¹ã‚¯ãƒªãƒ—ãƒˆ
=========================================
ğŸ“Š æµ®å‹•å°æ•°ç‚¹æ•°ã®æ¤œå‡º...
âœ… å•é¡Œãªã—
ğŸ”¬ ç§‘å­¦è¨˜æ³•ã®æ¤œå‡º...
âœ… å•é¡Œãªã—
```

### CI/CDã§ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯

PRã‚„ã‚³ãƒŸãƒƒãƒˆæ™‚ã«è‡ªå‹•çš„ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰æ¤œå‡ºãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## è¨±å¯ã•ã‚Œã‚‹ä¾‹å¤–

ä»¥ä¸‹ã®å€¤ã®ã¿ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å¯èƒ½ï¼š

- `0`, `1`, `2`, `-1`ï¼ˆåŸºæœ¬çš„ãªæ•´æ•°ï¼‰
- `0.5`ï¼ˆ1/2 ã®æ•°å­¦çš„è¡¨ç¾ï¼‰
- é…åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- ãƒ«ãƒ¼ãƒ—ã‚«ã‚¦ãƒ³ã‚¿
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã®èª¬æ˜çš„ãªæ•°å€¤

## ã‚ˆãã‚ã‚‹è³ªå•

### Q: playground/ã§ã®å®Ÿé¨“ã‚³ãƒ¼ãƒ‰ã‚‚å®šæ•°åŒ–ãŒå¿…è¦ï¼Ÿ

A: playground/ã¨scratch/ã¯ä¾‹å¤–ã§ã™ãŒã€å¯èƒ½ãªé™ã‚Šå®šæ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### Q: å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®šæ•°ã¯ã©ã†ã™ã‚‹ï¼Ÿ

A: æ„å‘³ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ãŸã‚ã€å¯èƒ½ãªé™ã‚Šå†å®šç¾©ã—ã¾ã™ï¼š

```rust
// std::f64::EPSILON ã‚ˆã‚Š
pub const MACHINE_EPSILON: f64 = std::f64::EPSILON;
```

### Q: ãƒ†ã‚¹ãƒˆå°‚ç”¨ã®å€¤ã¯ã©ã“ã«å®šç¾©ï¼Ÿ

A: `tests/conftest.py`ã«é›†ç´„ã™ã‚‹ã‹ã€å„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã§å®šç¾©ã—ã¾ã™ã€‚

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æ–°è¦ã‚³ãƒ¼ãƒ‰/PRãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç¢ºèªäº‹é …ï¼š

- [ ] æ•°å€¤ãƒªãƒ†ãƒ©ãƒ«ï¼ˆè¨±å¯ã•ã‚ŒãŸä¾‹å¤–ä»¥å¤–ï¼‰ãŒã™ã¹ã¦å®šæ•°åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] å®šæ•°ã«ã¯èª¬æ˜çš„ãªåå‰ãŒä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹
- [ ] åŒã˜å€¤ãŒè¤‡æ•°ç®‡æ‰€ã§é‡è¤‡ã—ã¦ã„ãªã„
- [ ] Rust/Pythoné–“ã§å…±é€šã®å€¤ãŒåŒæœŸã•ã‚Œã¦ã„ã‚‹
- [ ] `./scripts/detect_hardcode.sh`ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„

## ã¾ã¨ã‚

ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰é˜²æ­¢ã¯æŠ€è¡“çš„è² å‚µã‚’é˜²ãé‡è¦ãªå®Ÿè·µã§ã™ã€‚
ã€Œå¾Œã§ä¿®æ­£ã€ã§ã¯ãªãã€Œæœ€åˆã‹ã‚‰æ­£ã—ãã€å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€
ä¿å®ˆæ€§ã®é«˜ã„é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç¶­æŒã§ãã¾ã™ã€‚