# モデルドキュメントガイドライン

## 1. 基本原則

### 1.1 ユーザー読みやすさ最優先
- **即座に使える**: 最初のコード例まで10行以内
- **探しやすい**: 全モデルで統一された9セクション構造
- **適切な情報量**: 各セクション20行以内（使用例を除く）
- **視覚的整理**: コード例・表・箇条書きの活用

### 1.2 テンプレート使用の義務化
- **APIドキュメント**: `docs/internal/templates/api_model_template.md`を必ず使用
- **構造厳守**: セクション数・順序の変更禁止
- **命名規則遵守**: `docs/internal/naming_conventions.md`に準拠
- **理論と実装の分離**: 数学的理論は`docs/models/`、API使用方法は`docs/api/python/`

## 2. テンプレートの使用方法

### 2.1 新規モデル追加時の手順
1. `docs/internal/templates/api_model_template.md`をコピー
2. `docs/api/python/<model_name>.md`として保存
3. プレースホルダー`{...}`を実際の値に置換
4. セクション数は必ず9個を維持
5. 不要な内容は削除せず最小限に

### 2.2 必要なファイル
- `docs/api/python/<model_name>.md` - API使用方法（api_model_template.md使用）
- `docs/models/<model_name>.md` - 理論的背景（theory_model_template.md使用）
- 更新: `pricing.md`, `implied_vol.md`, `index.md`

## 3. APIドキュメント必須9セクション

### 3.1 セクション構成（順序・数厳守）

1. **タイトル＋導入文**（2行）
2. **概要**（2-3行）
3. **API使用方法**（40-60行）
   - 基本的な価格計算
   - バッチ処理
   - グリークス計算
   - インプライドボラティリティ
4. **パラメータ説明**（20-30行）
5. **価格式（参考）**（10-15行）
6. **エラーハンドリング**（10-15行）
7. **パフォーマンス指標**（5-10行）
8. **使用例**（30-40行、2例まで）
9. **関連情報**（3-5行）

### 3.2 記述ルール

**禁止事項:**
- ❌ 冗長な説明（コード例で示せることは説明しない）
- ❌ 将来実装の記載
- ❌ 他モデルとの詳細比較表
- ❌ 過度な理論的説明
- ❌ 10行を超える連続したテキスト

**パラメータ命名:**
- 必ず`naming_conventions.md`の省略形を使用
- 位置引数のみ（キーワード引数禁止）
- パラメータ説明は1行コメント

**コード例:**
```python
# ✅ 良い例
# パラメータ: s(spot), k(strike), t(time), r(rate), sigma
price = black_scholes.call_price(100.0, 105.0, 1.0, 0.05, 0.2)

# ❌ 悪い例
price = black_scholes.call_price(spot=100.0, strike=105.0, ...)  # キーワード引数
```

## 4. セクション別作成ガイド

### 4.1 良い例・悪い例

**概要セクション:**
```markdown
# ✅ 良い例（2-3行）
株式オプションの理論価格を計算するための基本モデルです。
対数正規分布に従う株価プロセスを仮定し、解析的な価格式を提供します。

# ❌ 悪い例（長すぎる）
Black-Scholesモデルは1973年にFischer BlackとMyron Scholesによって開発され、
その功績により1997年にノーベル経済学賞を受賞しました...（以下省略）
```

**パラメータ説明:**
```markdown
# ✅ 良い例（簡潔）
| `s` | float | スポット価格 | > 0 |

# ❌ 悪い例（冗長）
| `s` | float | 現在の原資産価格で、市場で観測される実際の取引価格を表し... | > 0 |
```

**使用例:**
```markdown
# ✅ 良い例（実務的、15-20行）
### ATMオプションの価格とグリークス
（実際に動く完全なコード例）

# ❌ 悪い例
### テスト
### サンプル1
（動かないコード片）
```

## 5. 理論ドキュメント構造 (`docs/models/<model_name>.md`)

### 5.1 テンプレート使用の義務化

- **理論ドキュメント**: `docs/internal/templates/theory_model_template.md`を必ず使用
- **統一構造**: 実装済み/未実装に関わらず同一の11セクション構造
- **実装状態の表示**: フロントマターと警告ボックスのみで区別

### 5.2 必須11セクション（順序厳守）

1. **理論的背景** - 基本概念と基本仮定
2. **価格式の導出** - 方程式と境界条件
3. **解析解** - コール・プットの価格式
4. **グリークス** - 感応度の導出
5. **他モデルとの関係** - 数学的関連性
6. **応用分野** - 実務での使用例
7. **数値計算上の考慮事項** - 精度と課題
8. **モデルの限界と拡張** - 制約と発展
9. **実装例（概念）** - 概念的なコード
10. **参考文献** - 学術文献
11. **関連ドキュメント** - リンク集

### 5.3 実装状態による違い

#### 未実装モデル
```yaml
---
future_feature: true
---
```
- 警告ボックスを冒頭に配置
- 実装例に「将来実装予定」コメント
- APIリンクに「（将来実装予定）」

#### 実装済みモデル
- フロントマターなし
- 警告ボックスなし
- 概念的な実装例を記載
- APIドキュメントへの実リンク

### 5.4 目標行数

- **全体**: 200-250行（実装状態に関わらず）
- **各セクション**: 15-30行（実装例・参考文献除く）

## 6. その他のファイル更新

### 6.1 pricing.md更新

```markdown
### [新モデル名]
[1行説明]。[主要入力パラメータ]を入力として使用します。

```python
from quantforge.models import {module_name}

# パラメータ: [省略形パラメータリスト]
price = {module_name}.call_price(...)
```

詳細: [[モデル名] API]({model_name}.md)
```

### 6.2 implied_vol.md更新

IV機能を持つモデルの場合、対応するセクションを追加

### 6.3 index.md toctree更新

新モデルをアルファベット順に追加

## 7. チェックリスト

### 新規ドキュメント作成時

- [ ] **テンプレート使用**: `api_model_template.md`をコピー
- [ ] **セクション数**: 9個厳守
- [ ] **行数制限**: 各セクション指定範囲内
- [ ] **命名規則**: `naming_conventions.md`準拠
- [ ] **コード例**: 動作確認済み
- [ ] **使用例**: 2例まで、実務的内容

### 既存ドキュメント修正時

- [ ] **Black76**: 16→9セクションに削減
- [ ] **Merton**: 使用例を4→2例に削減
- [ ] **Black-Scholes**: 微調整のみ

## 8. 参考資料

- `docs/internal/templates/api_model_template.md` - APIドキュメント用テンプレート
- `docs/internal/templates/theory_model_template.md` - 理論ドキュメント用テンプレート
- `docs/internal/naming_conventions.md` - パラメータ命名規則
- `docs/api/python/black_scholes.md` - 参考実装例